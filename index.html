<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #09090b; color: #fafafa; }
        .glass { background: rgba(18, 18, 21, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .chat-container::-webkit-scrollbar { width: 5px; }
        .chat-container::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
        pre code { border-radius: 8px; font-family: 'Fira Code', monospace !important; font-size: 13px !important; }
        .typing-dot { width: 4px; height: 4px; background: #a1a1aa; border-radius: 50%; animation: blink 1.4s infinite both; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside class="w-80 border-r border-zinc-800 flex flex-col hidden lg:flex bg-zinc-950">
        <div class="p-6 border-b border-zinc-800 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center font-bold">L</div>
                <span class="font-bold tracking-tight text-lg">Lumina</span>
            </div>
            <button onclick="resetChat()" class="p-2 hover:bg-zinc-900 rounded-lg transition text-zinc-400">
                <i data-lucide="plus-square" class="w-5 h-5"></i>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-2 chat-container" id="history-list">
            <div class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest px-2 pb-2">Recent Sessions</div>
            </div>

        <div class="p-4 border-t border-zinc-800">
            <div class="p-4 bg-zinc-900/50 rounded-xl border border-zinc-800">
                <p class="text-xs text-zinc-400 mb-2">Memory Usage</p>
                <div class="w-full bg-zinc-800 h-1 rounded-full overflow-hidden">
                    <div id="memory-bar" class="bg-indigo-500 h-full" style="width: 10%"></div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative bg-[#09090b]">
        <header class="h-16 border-b border-zinc-800 glass flex items-center justify-between px-6 z-10">
            <div class="flex items-center gap-4">
                <select id="model-mode" class="bg-transparent border-none focus:ring-0 text-sm font-semibold cursor-pointer text-zinc-300 hover:text-white transition">
                    <option value="general">Standard Assistant</option>
                    <option value="coding">Expert Developer</option>
                    <option value="study">Socratic Tutor</option>
                </select>
            </div>
            <div class="flex items-center gap-3">
                <div id="api-status" class="px-2 py-1 rounded-md bg-green-500/10 text-green-500 text-[10px] font-bold border border-green-500/20">
                    GEMINI ACTIVE
                </div>
            </div>
        </header>

        <div id="chat-scroller" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 chat-container">
            <div id="empty-view" class="h-full flex flex-col items-center justify-center max-w-2xl mx-auto text-center">
                <div class="w-20 h-20 bg-indigo-600/10 text-indigo-500 rounded-3xl flex items-center justify-center mb-6 border border-indigo-600/20">
                    <i data-lucide="zap" class="w-10 h-10"></i>
                </div>
                <h1 class="text-3xl font-bold mb-4">Lumina Intelligence</h1>
                <p class="text-zinc-400 mb-8">A clean, private interface for Gemini. No tracking, local memory, and full markdown support.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full">
                    <button onclick="quickPrompt('Draft a minimalist travel itinerary for Tokyo')" class="p-4 bg-zinc-900 border border-zinc-800 rounded-xl text-left hover:border-indigo-500 transition group">
                        <p class="text-sm font-medium">Draft a travel itinerary...</p>
                        <p class="text-xs text-zinc-500 group-hover:text-indigo-400 transition">Travel & Planning</p>
                    </button>
                    <button onclick="quickPrompt('Explain the difference between a Map and a WeakMap in JS')" class="p-4 bg-zinc-900 border border-zinc-800 rounded-xl text-left hover:border-indigo-500 transition group">
                        <p class="text-sm font-medium">Map vs WeakMap in JS...</p>
                        <p class="text-xs text-zinc-500 group-hover:text-indigo-400 transition">Development</p>
                    </button>
                </div>
            </div>
            <div id="chat-content" class="max-w-4xl mx-auto space-y-8 pb-12"></div>
        </div>

        <div class="p-4 md:p-6 bg-gradient-to-t from-[#09090b] via-[#09090b] to-transparent">
            <div class="max-w-4xl mx-auto">
                <div class="relative flex items-end gap-2 bg-zinc-900 border border-zinc-800 rounded-2xl p-2 shadow-2xl focus-within:border-zinc-600 transition">
                    <textarea id="prompt-input" rows="1" 
                        placeholder="Ask anything..."
                        class="flex-1 bg-transparent border-none focus:ring-0 py-3 px-4 resize-none text-zinc-100 placeholder-zinc-500 max-h-60"
                        oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"></textarea>
                    <button id="send-btn" onclick="handleSend()" class="p-3 bg-white text-black rounded-xl hover:bg-zinc-200 transition-all disabled:opacity-50 disabled:grayscale">
                        <i data-lucide="arrow-up" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex justify-between items-center px-4 mt-3">
                    <div class="flex gap-4">
                        <button class="text-zinc-500 hover:text-zinc-300 transition text-xs flex items-center gap-1">
                            <i data-lucide="paperclip" class="w-3 h-3"></i> Attach
                        </button>
                        <button class="text-zinc-500 hover:text-zinc-300 transition text-xs flex items-center gap-1">
                            <i data-lucide="mic" class="w-3 h-3"></i> Voice
                        </button>
                    </div>
                    <span id="token-count" class="text-[10px] text-zinc-600 font-mono uppercase tracking-widest">Context: 0 tokens</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- CONFIG & STATE ---
        const CONFIG = {
            API_KEY: 'AIzaSyDI4sYAdGRignCmjEU9YbtzceWH9dEyzNE',
            MODEL: 'gemini-2.5-flash',
            SYSTEM_PROMPTS: {
                general: "You are Lumina, a helpful and minimalist AI assistant. Keep answers clear and direct.",
                coding: "You are a Senior Full-Stack Architect. Provide efficient code, explain your logic, and always use best practices.",
                study: "You are a Socratic Tutor. Instead of giving direct answers, ask guiding questions to help the user learn."
            }
        };

        let chatHistory = []; // Local session memory

        // --- CORE FUNCTIONS ---
        async function handleSend() {
            const inputEl = document.getElementById('prompt-input');
            const text = inputEl.value.trim();
            const mode = document.getElementById('model-mode').value;
            
            if (!text) return;

            // UI Prep
            document.getElementById('empty-view').classList.add('hidden');
            inputEl.value = '';
            inputEl.style.height = 'auto';
            
            // Add User Message
            appendMessage('user', text);
            
            // Show Typing Indicator
            const loadingId = showTypingIndicator();

            try {
                // Construct the payload with history for memory
                const payload = {
                    contents: [
                        { role: 'user', parts: [{ text: CONFIG.SYSTEM_PROMPTS[mode] }] }, // System instruction injection
                        ...chatHistory,
                        { role: 'user', parts: [{ text: text }] }
                    ],
                    generationConfig: { temperature: 0.7, maxOutputTokens: 2048 }
                };

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${CONFIG.MODEL}:generateContent?key=${CONFIG.API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                removeTypingIndicator(loadingId);

                if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    
                    // Update History for context
                    chatHistory.push({ role: 'user', parts: [{ text: text }] });
                    chatHistory.push({ role: 'model', parts: [{ text: aiText }] });
                    
                    appendMessage('ai', aiText);
                    updateStats();
                } else {
                    throw new Error("Invalid response");
                }
            } catch (error) {
                console.error(error);
                removeTypingIndicator(loadingId);
                appendMessage('ai', "I encountered a connection error. Please verify your internet or API limits.");
            }
        }

        // --- UI HELPERS ---
        function appendMessage(role, text) {
            const container = document.getElementById('chat-content');
            const wrapper = document.createElement('div');
            wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-4 duration-500`;
            
            const htmlContent = marked.parse(text);
            
            wrapper.innerHTML = `
                <div class="flex gap-4 max-w-[85%] ${role === 'user' ? 'flex-row-reverse' : 'flex-row'}">
                    <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-[10px] font-bold border ${role === 'user' ? 'bg-indigo-600 border-indigo-400' : 'bg-zinc-800 border-zinc-700'}">
                        ${role === 'user' ? 'YOU' : 'AI'}
                    </div>
                    <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl shadow-sm ${role === 'user' ? 'rounded-tr-none border-indigo-500/30 bg-indigo-500/5' : 'rounded-tl-none'}">
                        <div class="prose prose-invert prose-sm max-w-none text-zinc-200 leading-relaxed">
                            ${htmlContent}
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(wrapper);
            hljs.highlightAll();
            scrollChat();
        }

        function showTypingIndicator() {
            const id = 'loading-' + Date.now();
            const container = document.getElementById('chat-content');
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex gap-4 items-center p-5 bg-zinc-900/50 border border-zinc-800 rounded-2xl rounded-tl-none w-20";
            div.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
            container.appendChild(div);
            scrollChat();
            return id;
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollChat() {
            const scroller = document.getElementById('chat-scroller');
            scroller.scrollTo({ top: scroller.scrollHeight, behavior: 'smooth' });
        }

        function quickPrompt(text) {
            document.getElementById('prompt-input').value = text;
            handleSend();
        }

        function resetChat() {
            chatHistory = [];
            document.getElementById('chat-content').innerHTML = '';
            document.getElementById('empty-view').classList.remove('hidden');
            updateStats();
        }

        function updateStats() {
            const count = chatHistory.length;
            document.getElementById('token-count').innerText = `Context: ${count} Messages`;
            document.getElementById('memory-bar').style.width = `${Math.min(count * 10, 100)}%`;
        }

        // --- LISTENERS ---
        document.getElementById('prompt-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        lucide.createIcons();
    </script>
</body>
</html>
